"$schema" = 'https://starship.rs/config-schema.json'

add_newline = false

format = """
${custom.vm_ctx}${custom.git_repo}$directory$git_branch$git_status
$character
"""

# -------------------------
# VM ctx (SSH時のみ表示 / それ以外は空)
# -------------------------
[custom.vm_ctx]
when = '[ -n "$SSH_CONNECTION" ] || [ -n "$SSH_TTY" ]'
command = "printf 'VM'"
style = "fg:#6c7086"
format = "[$output]($style) "

# -------------------------
# Git repo/worktree ctx
#   - 通常: repo
#   - git-wt (.worktrees/<name>) 配下: repo@<worktree>
# -------------------------
[custom.git_repo]
when = "git rev-parse --is-inside-work-tree >/dev/null 2>&1"
command = '''
top=$(git rev-parse --show-toplevel 2>/dev/null) || exit 0

repo_root=$top
wt=""

case "$top" in
  */.worktrees/*)
    wt=${top#*/.worktrees/}
    wt=${wt%%/*}
    repo_root=${top%/.worktrees/*}
    ;;
esac

repo=${repo_root##*/}

if [ -n "$wt" ]; then
  printf "%s@%s" "$repo" "$wt"
else
  printf "%s" "$repo"
fi
'''
style = "bold fg:#89b4fa"
format = "[$output]($style) "
# -------------------------
# Directory (Pure寄り)
#   - repo配下では repo からの相対パスにする（末尾表示）
#   - repo外では通常のパス
# -------------------------
[directory]
truncation_length = 6
home_symbol = "~"
truncate_to_repo = true
read_only = " 󰌾"
style = "bold fg:#89b4fa"
read_only_style = "fg:#f38ba8"

# repo 外のとき（従来どおり）
format = "[$path]($style)[$read_only]($read_only_style) "

# repo 内のとき：repo ルート名($repo_root)を出さず、repo内パス($path)だけにする
before_repo_root_style = "bold fg:#89b4fa"
repo_root_style = "bold fg:#89b4fa"
repo_root_format = "[$path]($style)[$read_only]($read_only_style) "

# -------------------------
# Git (薄いグレー / Pure寄り)
# -------------------------
[git_branch]
symbol = ""
style = "fg:#6c7086"
format = "[$symbol $branch]($style) "

# dirty のときだけ表示に寄せる：
#   - modified/staged/renamed/deleted/untracked/stashed がある場合だけ出る
#   - ahead/behind も「変更があるときだけ」でよければこのまま
[git_status]
style = "fg:#6c7086"
format = "[$all_status$ahead_behind]($style) "
stashed = "*"  # 好みで（Pure寄りに控えめな記号）

# 変更がないときは完全に空にする（dirtyのみ）
# ※ Starship は clean時に $all_status が空になるので、結果として何も出ません
#   さらに厳密にしたい場合は下の custom.git_dirty_gate を使います（後述）

# -------------------------
# Prompt
# -------------------------
[character]
success_symbol = "[❯](bold fg:#a6e3a1)"
error_symbol = "[❯](bold fg:#f38ba8)"
vimcmd_symbol = "[V](bold fg:#a6e3a1)"

# -------------------------
# cmd_duration 非表示
# -------------------------
[cmd_duration]
disabled = true

# (不要モジュール)
[python]
disabled = true
[direnv]
disabled = true
[aws]
disabled = true
[time]
disabled = true
[gcloud]
disabled = true

